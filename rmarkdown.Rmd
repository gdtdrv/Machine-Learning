---
title: "Spatio-temporal prediction of ambulance calls"
subtitle: ""

output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Dissertation project was done in cooperation with the North West Ambulance Service.

Project supervisors are Dr Anastasios Noulas from New York University and Dr Andrew Titman from Lancaster University.

### Exploratory Data Analysis


##### Clear weekly pattern for some types of problems

It is examined if the calls related to certain type of problems have stable temporal behavior through the year. This is tested by plotting the number of calls for each month in terms of hour of the week. It can be seen that there is a clear temporal pattern, which doesn't have monthly variations. 

```{r pressure, echo=FALSE,results='hide', message=FALSE, warning=FALSE}
library(ggplot2)
library(rjson)
library(googleVis)
library(networkD3)

mm_nat <- read.csv("E:/University of Lancaster/Dissertation/Exploratory Data Analysis/mm_nat_wh")

### examine if the data has similar hourly patterns for each month

mm_nat$MM <- as.factor(mm_nat$MM)

n6<-ggplot(mm_nat) +  geom_line(aes(x = WH ,y = nat_29 , color = MM)) +
  theme(legend.position="none")+
  labs(title = " Traffic Incidents") +
  scale_x_continuous(breaks=seq(0, 168, 12)) + xlab("Hour of the Week") + ylab("Number of Calls")

plot(n6)
```

##### Strong connection between human activities and ambulance calls


Normalised urban activity frequencies versus ambulance call frequencies. Check-ins at nightlife places such as Pubs present a strong alignment over time with Assault related ambulance calls. Hour 0 represents Monday 0-1am.

```{r echo=FALSE,results='hide', message=FALSE, warning=FALSE}
library(ggplot2)

nighlife_pattern_pair<-read.csv('E:/University of Lancaster/Paper/nighlife_pattern_pair.csv')
ggplot(nighlife_pattern_pair) +  geom_line(aes(x = WH, y = percent, group=category, color = category)) +
  theme(legend.position="bottom")+
 # labs(title = "Temporal pattern weekly") +
  scale_x_continuous(breaks=seq(0, 168, 24))  + xlab("Hour of the Week") + ylab("Frequency")

```

##### Some type of problems share temporal and spatial pattern

Analysing where and when calls from various types of problem occur, it turned out that some of them happen at the same place and at the same time. 

![](E:/Job applications/gery/Documents/rmarkdown_files/figure-markdown_github/23m.png)

![](E:/Job applications/gery/Documents/rmarkdown_files/figure-markdown_github/25m.png)



##### Decomposition

Decompostion of time series showed trend, seasonality and mulitplicative relationship between them. 


```{r echo=FALSE,results='hide', message=FALSE, warning=FALSE}
library(dplyr)
library(plyr)
library(reshape)
library(lubridate)
library(reshape2)
library(stringr)
library(forecast)
library(TStools)
library(smooth)
library(ggplot2)
library(xtable)
library(ggthemes)
library(gridExtra)
library("scales")
library("ggseas")
Sys.setlocale("LC_ALL", "English")


##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
# read the data
daily_data <- read.csv(file= "E:/University of Lancaster/Dissertation/Time series/daily_data.csv")
daily_data <- daily_data[1:1820,]
daily_data[,2] <- as.Date(daily_data[,2], "%Y-%m-%d", tz="GMT" )

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 

dec<-ggsdc(daily_data, 
           aes(x = incdate, y = freq),frequency = 365, method = "decompose", start = c(2013, 04,01),
      type = "multiplicative") +  geom_line(size = 0.2,color = "#00AFBB" ) +  theme_light(8) +
  labs(x = "", colour = "", y= "") 

plot(dec)
```

### Methods



